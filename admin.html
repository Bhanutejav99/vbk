<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBK Designs - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vbk-navy': '#0f1424',
                        'vbk-card': '#1c2136',
                        'vbk-mid': '#2d3250',
                        'vbk-gold': '#f9b17a',
                        'vbk-purple': '#6769fd',
                    }
                }
            }
        }
    </script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
        }

        /* Sidebar */
        .sidebar {
            transition: width 0.3s;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        /* Table */
        .data-table th {
            position: sticky;
            top: 0;
            background: #1c2136;
            z-index: 10;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Modal */
        .modal {
            transition: opacity 0.2s, visibility 0.2s;
        }

        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .modal-content {
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .modal:not(.hidden) .modal-content {
            transform: scale(1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #1c2136;
        }

        ::-webkit-scrollbar-thumb {
            background: #3d4260;
            border-radius: 3px;
        }

        /* Toast */
        .toast {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="bg-vbk-navy text-white min-h-screen">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-vbk-card w-full max-w-md p-8 rounded-2xl border border-vbk-mid/30 shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-vbk-gold mb-2">VBK Designs</h1>
                <p class="text-gray-400 text-sm">Admin Dashboard</p>
            </div>

            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Email</label>
                    <input type="email" id="login-email" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 text-white focus:border-vbk-gold focus:outline-none transition"
                        placeholder="admin@vbkdesigns.com">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Password</label>
                    <input type="password" id="login-password" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 text-white focus:border-vbk-gold focus:outline-none transition"
                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button type="submit" id="login-btn"
                    class="w-full bg-vbk-gold text-vbk-navy font-bold py-3 rounded-lg hover:bg-white transition mt-4">
                    <i class="fa-solid fa-right-to-bracket mr-2"></i> Login
                </button>
            </form>

            <p id="login-error" class="text-red-400 text-sm text-center mt-4 hidden"></p>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar fixed left-0 top-0 h-full w-64 bg-vbk-card border-r border-vbk-mid/30 z-50 flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b border-vbk-mid/30">
                <h1 class="text-xl font-bold text-vbk-gold flex items-center gap-3">
                    <i class="fa-solid fa-gem"></i>
                    <span class="logo-text">VBK Admin</span>
                </h1>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" data-page="dashboard"
                    class="nav-link active flex items-center gap-3 px-4 py-3 rounded-lg text-white bg-vbk-purple/20 border-l-4 border-vbk-purple">
                    <i class="fa-solid fa-chart-pie w-5"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" data-page="products"
                    class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition">
                    <i class="fa-solid fa-box w-5"></i>
                    <span class="nav-text">Products</span>
                </a>
                <a href="#" data-page="categories"
                    class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition">
                    <i class="fa-solid fa-folder w-5"></i>
                    <span class="nav-text">Categories</span>
                </a>
                <a href="#" data-page="orders"
                    class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition">
                    <i class="fa-solid fa-shopping-cart w-5"></i>
                    <span class="nav-text">Orders</span>
                </a>
                <a href="#" data-page="offers"
                    class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition">
                    <i class="fa-solid fa-tags w-5"></i>
                    <span class="nav-text">Offers</span>
                </a>
                <a href="#" data-page="customers"
                    class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition">
                    <i class="fa-solid fa-users w-5"></i>
                    <span class="nav-text">Customers</span>
                </a>
            </nav>


            <!-- User -->
            <div class="p-4 border-t border-vbk-mid/30">
                <button onclick="logout()"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-red-400 hover:bg-red-500/10 transition">
                    <i class="fa-solid fa-right-from-bracket w-5"></i>
                    <span class="nav-text">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 min-h-screen">
            <!-- Header -->
            <header class="sticky top-0 bg-vbk-navy/95 backdrop-blur-lg border-b border-vbk-mid/30 px-6 py-4 z-40">
                <div class="flex items-center justify-between">
                    <h2 id="page-title" class="text-xl font-bold">Dashboard</h2>
                    <div class="flex items-center gap-4">
                        <span id="admin-email" class="text-sm text-gray-400"></span>
                        <a href="index.html" target="_blank"
                            class="px-4 py-2 bg-vbk-mid rounded-lg text-sm hover:bg-vbk-purple transition">
                            <i class="fa-solid fa-external-link mr-2"></i> View Site
                        </a>
                    </div>
                </div>
            </header>

            <!-- Dashboard Page -->
            <section id="page-dashboard" class="page p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Stats Cards -->
                    <div class="bg-vbk-card rounded-xl p-6 border border-vbk-mid/30">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-gray-400 text-sm">Total Products</span>
                            <i class="fa-solid fa-box text-vbk-purple text-xl"></i>
                        </div>
                        <p id="stat-products" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-vbk-card rounded-xl p-6 border border-vbk-mid/30">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-gray-400 text-sm">Active Offers</span>
                            <i class="fa-solid fa-tags text-green-400 text-xl"></i>
                        </div>
                        <p id="stat-offers" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-vbk-card rounded-xl p-6 border border-vbk-mid/30">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-gray-400 text-sm">Customers</span>
                            <i class="fa-solid fa-users text-blue-400 text-xl"></i>
                        </div>
                        <p id="stat-customers" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-vbk-card rounded-xl p-6 border border-vbk-mid/30">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-gray-400 text-sm">This Month</span>
                            <i class="fa-solid fa-chart-line text-vbk-gold text-xl"></i>
                        </div>
                        <p class="text-3xl font-bold text-vbk-gold">â‚¹0</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-vbk-card rounded-xl p-6 border border-vbk-mid/30">
                    <h3 class="text-lg font-bold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="showPage('products'); openProductModal()"
                            class="p-4 bg-vbk-navy rounded-lg hover:bg-vbk-purple/20 transition text-center">
                            <i class="fa-solid fa-plus text-2xl text-vbk-gold mb-2"></i>
                            <p class="text-sm">Add Product</p>
                        </button>
                        <button onclick="showPage('offers'); openOfferModal()"
                            class="p-4 bg-vbk-navy rounded-lg hover:bg-vbk-purple/20 transition text-center">
                            <i class="fa-solid fa-ticket text-2xl text-green-400 mb-2"></i>
                            <p class="text-sm">Create Offer</p>
                        </button>
                        <button onclick="showPage('products')"
                            class="p-4 bg-vbk-navy rounded-lg hover:bg-vbk-purple/20 transition text-center">
                            <i class="fa-solid fa-list text-2xl text-blue-400 mb-2"></i>
                            <p class="text-sm">View Products</p>
                        </button>
                        <a href="index.html" target="_blank"
                            class="p-4 bg-vbk-navy rounded-lg hover:bg-vbk-purple/20 transition text-center">
                            <i class="fa-solid fa-globe text-2xl text-purple-400 mb-2"></i>
                            <p class="text-sm">View Site</p>
                        </a>
                    </div>
                </div>
            </section>

            <!-- Products Page -->
            <section id="page-products" class="page hidden p-6">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <input type="text" id="product-search" placeholder="Search products..."
                            class="bg-vbk-card border border-vbk-mid rounded-lg px-4 py-2 w-64 focus:border-vbk-gold focus:outline-none">
                        <select id="product-filter"
                            class="bg-vbk-card border border-vbk-mid rounded-lg px-4 py-2 focus:border-vbk-gold focus:outline-none">
                            <option value="">All Categories</option>
                            <option value="blouses">Blouses</option>
                            <option value="wedding">Wedding</option>
                            <option value="lehanga-designs">Lehangas</option>
                            <option value="maggam-designs">Maggam</option>
                            <option value="Kurthi-designs">Kurthis</option>
                            <option value="frock-designs">Frocks</option>
                            <option value="materials">Materials</option>
                        </select>
                    </div>
                    <button onclick="openProductModal()"
                        class="px-6 py-2 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        <i class="fa-solid fa-plus mr-2"></i> Add Product
                    </button>
                </div>

                <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                    <div class="overflow-x-auto max-h-[calc(100vh-250px)]">
                        <table class="data-table w-full text-sm">
                            <thead>
                                <tr class="text-left text-gray-400 uppercase text-xs">
                                    <th class="p-4">Image</th>
                                    <th class="p-4">Title</th>
                                    <th class="p-4">Category</th>
                                    <th class="p-4">Price</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Offers Page -->
            <section id="page-offers" class="page hidden p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold">Manage Offers & Coupons</h3>
                    <button onclick="openOfferModal()"
                        class="px-6 py-2 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        <i class="fa-solid fa-plus mr-2"></i> Add Offer
                    </button>
                </div>

                <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                    <table class="data-table w-full text-sm">
                        <thead>
                            <tr class="text-left text-gray-400 uppercase text-xs">
                                <th class="p-4">Code</th>
                                <th class="p-4">Description</th>
                                <th class="p-4">Discount</th>
                                <th class="p-4">Min Order</th>
                                <th class="p-4">Valid Until</th>
                                <th class="p-4">Status</th>
                                <th class="p-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="offers-table">
                            <!-- Offers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Customers Page -->
            <section id="page-customers" class="page hidden p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold">Customer List</h3>
                    <input type="text" id="customer-search" placeholder="Search customers..."
                        class="bg-vbk-card border border-vbk-mid rounded-lg px-4 py-2 w-64 focus:border-vbk-gold focus:outline-none">
                </div>

                <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                    <table class="data-table w-full text-sm">
                        <thead>
                            <tr class="text-left text-gray-400 uppercase text-xs">
                                <th class="p-4">Name</th>
                                <th class="p-4">Email</th>
                                <th class="p-4">Phone</th>
                                <th class="p-4">City</th>
                                <th class="p-4">Orders</th>
                                <th class="p-4">Joined</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table">
                            <!-- Customers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Categories Page -->
            <section id="page-categories" class="page hidden p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold">Manage Categories</h3>
                    <button onclick="openCategoryModal()"
                        class="px-6 py-2 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        <i class="fa-solid fa-plus mr-2"></i> Add Category
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Categories List -->
                    <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                        <div class="p-4 border-b border-vbk-mid/30">
                            <h4 class="font-semibold">Categories</h4>
                        </div>
                        <div class="max-h-[400px] overflow-y-auto">
                            <table class="data-table w-full text-sm">
                                <thead>
                                    <tr class="text-left text-gray-400 uppercase text-xs">
                                        <th class="p-4">Name</th>
                                        <th class="p-4">Slug</th>
                                        <th class="p-4">Products</th>
                                        <th class="p-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categories-table">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Subcategories List -->
                    <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                        <div class="p-4 border-b border-vbk-mid/30 flex items-center justify-between">
                            <h4 class="font-semibold">Subcategories</h4>
                            <button onclick="openSubcategoryModal()"
                                class="px-4 py-1 bg-vbk-purple text-white text-xs font-bold rounded-lg hover:bg-vbk-gold hover:text-vbk-navy transition">
                                <i class="fa-solid fa-plus mr-1"></i> Add
                            </button>
                        </div>
                        <div class="max-h-[400px] overflow-y-auto">
                            <table class="data-table w-full text-sm">
                                <thead>
                                    <tr class="text-left text-gray-400 uppercase text-xs">
                                        <th class="p-4">Name</th>
                                        <th class="p-4">Category</th>
                                        <th class="p-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="subcategories-table">
                                    <!-- Subcategories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Page -->
            <section id="page-orders" class="page hidden p-6">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <h3 class="text-lg font-bold">Orders</h3>
                        <select id="order-status-filter"
                            class="bg-vbk-card border border-vbk-mid rounded-lg px-4 py-2 text-sm focus:border-vbk-gold focus:outline-none">
                            <option value="">All Status</option>
                            <option value="pending">ðŸŸ¡ Pending</option>
                            <option value="accepted">ðŸŸ¢ Accepted</option>
                            <option value="processing">ðŸ”µ Processing</option>
                            <option value="shipped">ðŸŸ£ Shipped</option>
                            <option value="delivered">âœ… Delivered</option>
                            <option value="cancelled">ðŸ”´ Cancelled</option>
                        </select>
                    </div>
                    <input type="text" id="order-search" placeholder="Search by order #..."
                        class="bg-vbk-card border border-vbk-mid rounded-lg px-4 py-2 w-64 focus:border-vbk-gold focus:outline-none">
                </div>

                <div class="bg-vbk-card rounded-xl border border-vbk-mid/30 overflow-hidden">
                    <div class="overflow-x-auto max-h-[calc(100vh-250px)]">
                        <table class="data-table w-full text-sm">
                            <thead>
                                <tr class="text-left text-gray-400 uppercase text-xs">
                                    <th class="p-4">Order #</th>
                                    <th class="p-4">Customer</th>
                                    <th class="p-4">Items</th>
                                    <th class="p-4">Amount</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Date</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>

    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80">
        <div
            class="modal-content bg-vbk-card w-full max-w-2xl rounded-xl border border-vbk-mid/30 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-vbk-mid/30 flex items-center justify-between">
                <h3 id="product-modal-title" class="text-xl font-bold">Add Product</h3>
                <button onclick="closeProductModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <form id="product-form" class="p-6 space-y-4">
                <input type="hidden" id="product-id">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-xs uppercase text-gray-500 mb-2">Title *</label>
                        <input type="text" id="product-title" required
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Category *</label>
                        <select id="product-cat" required
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Sub-category</label>
                        <select id="product-sub"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                            <option value="">Select Subcategory</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Price (â‚¹) *</label>
                        <input type="number" id="product-price" required min="0"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Discount %</label>
                        <input type="number" id="product-discount" min="0" max="100" value="0"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>

                    <!-- Main Image -->
                    <div class="col-span-2">
                        <label class="block text-xs uppercase text-gray-500 mb-2">Main Image URL *</label>
                        <div class="flex gap-3">
                            <input type="url" id="product-img" required
                                class="flex-1 bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                                placeholder="https://..." onchange="previewMainImage()">
                            <div id="main-img-preview"
                                class="w-16 h-16 rounded-lg bg-vbk-mid flex items-center justify-center overflow-hidden">
                                <i class="fa-solid fa-image text-gray-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Gallery Images -->
                    <div class="col-span-2">
                        <label class="block text-xs uppercase text-gray-500 mb-2">Gallery Images (up to 10)</label>
                        <div class="flex gap-2 mb-3">
                            <input type="url" id="gallery-img-input"
                                class="flex-1 bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                                placeholder="Paste image URL and click Add">
                            <button type="button" onclick="addGalleryImage()"
                                class="px-4 py-2 bg-vbk-purple text-white rounded-lg hover:bg-vbk-gold hover:text-vbk-navy transition">
                                <i class="fa-solid fa-plus mr-1"></i> Add
                            </button>
                        </div>
                        <div id="gallery-preview" class="flex flex-wrap gap-2">
                            <!-- Gallery thumbnails will appear here -->
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fa-solid fa-info-circle mr-1"></i>
                            <span id="gallery-count">0</span>/10 images added. Click Ã— to remove.
                        </p>
                    </div>

                    <!-- Description -->
                    <div class="col-span-2">
                        <label class="block text-xs uppercase text-gray-500 mb-2">Description</label>
                        <textarea id="product-desc" rows="2"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                            placeholder="Product description..."></textarea>
                    </div>

                    <div class="col-span-2 flex items-center gap-6">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="product-active" checked class="w-4 h-4 accent-vbk-gold">
                            <span class="text-sm">Active</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="product-bestseller" class="w-4 h-4 accent-vbk-gold">
                            <span class="text-sm">Bestseller</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="product-new" class="w-4 h-4 accent-vbk-gold">
                            <span class="text-sm">New Arrival</span>
                        </label>
                    </div>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeProductModal()"
                        class="flex-1 px-6 py-3 border border-vbk-mid rounded-lg hover:bg-vbk-mid transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        Save Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Offer Modal -->
    <div id="offer-modal" class="modal hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80">
        <div class="modal-content bg-vbk-card w-full max-w-lg rounded-xl border border-vbk-mid/30">
            <div class="p-6 border-b border-vbk-mid/30 flex items-center justify-between">
                <h3 id="offer-modal-title" class="text-xl font-bold">Add Offer</h3>
                <button onclick="closeOfferModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <form id="offer-form" class="p-6 space-y-4">
                <input type="hidden" id="offer-id">
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Coupon Code *</label>
                    <input type="text" id="offer-code" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none uppercase"
                        placeholder="e.g., VBK20">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Description</label>
                    <input type="text" id="offer-desc"
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., 20% OFF on first order">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Discount %</label>
                        <input type="number" id="offer-discount" min="0" max="100"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Min Order (â‚¹)</label>
                        <input type="number" id="offer-min" min="0" value="0"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Valid Until</label>
                    <input type="date" id="offer-valid"
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                </div>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="offer-active" checked class="w-4 h-4 accent-vbk-gold">
                    <span class="text-sm">Active</span>
                </label>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeOfferModal()"
                        class="flex-1 px-6 py-3 border border-vbk-mid rounded-lg hover:bg-vbk-mid transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        Save Offer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal"
        class="modal hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80">
        <div class="modal-content bg-vbk-card w-full max-w-md rounded-xl border border-vbk-mid/30">
            <div class="p-6 border-b border-vbk-mid/30 flex items-center justify-between">
                <h3 id="category-modal-title" class="text-xl font-bold">Add Category</h3>
                <button onclick="closeCategoryModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <form id="category-form" class="p-6 space-y-4">
                <input type="hidden" id="category-id">
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Category Name *</label>
                    <input type="text" id="category-name" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., Blouses">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Slug *</label>
                    <input type="text" id="category-slug" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., blouses">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Icon (Font Awesome)</label>
                    <input type="text" id="category-icon"
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., fa-shirt">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Image URL</label>
                    <input type="url" id="category-image"
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="https://...">
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeCategoryModal()"
                        class="flex-1 px-6 py-3 border border-vbk-mid rounded-lg hover:bg-vbk-mid transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Subcategory Modal -->
    <div id="subcategory-modal"
        class="modal hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80">
        <div class="modal-content bg-vbk-card w-full max-w-md rounded-xl border border-vbk-mid/30">
            <div class="p-6 border-b border-vbk-mid/30 flex items-center justify-between">
                <h3 id="subcategory-modal-title" class="text-xl font-bold">Add Subcategory</h3>
                <button onclick="closeSubcategoryModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <form id="subcategory-form" class="p-6 space-y-4">
                <input type="hidden" id="subcategory-id">
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Parent Category *</label>
                    <select id="subcategory-parent" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                        <option value="">Select Category</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Subcategory Name *</label>
                    <input type="text" id="subcategory-name" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., V Neck">
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 mb-2">Slug *</label>
                    <input type="text" id="subcategory-slug" required
                        class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                        placeholder="e.g., v-neck">
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeSubcategoryModal()"
                        class="flex-1 px-6 py-3 border border-vbk-mid rounded-lg hover:bg-vbk-mid transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="order-modal" class="modal hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80">
        <div
            class="modal-content bg-vbk-card w-full max-w-2xl rounded-xl border border-vbk-mid/30 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-vbk-mid/30 flex items-center justify-between">
                <h3 id="order-modal-title" class="text-xl font-bold">Order Details</h3>
                <button onclick="closeOrderModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <div id="order-detail" class="p-6">
                <!-- Order details will be loaded here -->
            </div>
            <form id="order-update-form" class="p-6 border-t border-vbk-mid/30 space-y-4">
                <input type="hidden" id="order-id">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Status</label>
                        <select id="order-status"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                            <option value="pending">ðŸŸ¡ Pending</option>
                            <option value="accepted">ðŸŸ¢ Accepted</option>
                            <option value="processing">ðŸ”µ Processing</option>
                            <option value="shipped">ðŸŸ£ Shipped</option>
                            <option value="delivered">âœ… Delivered</option>
                            <option value="cancelled">ðŸ”´ Cancelled</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Shipping Carrier</label>
                        <input type="text" id="order-carrier"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                            placeholder="e.g., DTDC, BlueDart">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Tracking Number</label>
                        <input type="text" id="order-tracking"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                            placeholder="Tracking ID">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-gray-500 mb-2">Est. Delivery</label>
                        <input type="date" id="order-delivery"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs uppercase text-gray-500 mb-2">Admin Notes</label>
                        <textarea id="order-notes" rows="2"
                            class="w-full bg-vbk-navy border border-vbk-mid rounded-lg p-3 focus:border-vbk-gold focus:outline-none"
                            placeholder="Internal notes..."></textarea>
                    </div>
                </div>
                <div class="flex gap-4 pt-2">
                    <button type="button" onclick="closeOrderModal()"
                        class="flex-1 px-6 py-3 border border-vbk-mid rounded-lg hover:bg-vbk-mid transition">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-6 py-3 bg-vbk-gold text-vbk-navy font-bold rounded-lg hover:bg-white transition">
                        Update Order
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-[200] space-y-2"></div>

    <script>
        // === SUPABASE CONFIG ===
        const SUPABASE_URL = 'https://rgekvrlxmwxnpcxpnvdn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZWt2cmx4bXd4bnBjeHBudmRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NDM5ODUsImV4cCI6MjA4MDUxOTk4NX0.lCXjqFD7Mlcawa2G481wJmliJ4JSxNJbaXgewylvIc8';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // === AUTH ===
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                showDashboard(session.user);
            }
        }

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            const btn = document.getElementById('login-btn');

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Logging in...';
            errorEl.classList.add('hidden');

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-right-to-bracket mr-2"></i> Login';
            } else {
                showDashboard(data.user);
            }
        });

        async function logout() {
            await supabase.auth.signOut();
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            toast('Logged out successfully', 'info');
        }

        function showDashboard(user) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('admin-email').textContent = user.email;
            loadDashboardStats();
            loadProducts();
            loadCategories();
            loadSubcategories();
            loadOrders();
            loadOffers();
            loadCustomers();
        }

        // === NAVIGATION ===
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.dataset.page;
                showPage(page);
            });
        });

        function showPage(page) {
            // Update nav
            document.querySelectorAll('.nav-link').forEach(l => {
                l.classList.remove('active', 'bg-vbk-purple/20', 'border-l-4', 'border-vbk-purple', 'text-white');
                l.classList.add('text-gray-400');
            });
            const activeLink = document.querySelector(`[data-page="${page}"]`);
            activeLink.classList.add('active', 'bg-vbk-purple/20', 'border-l-4', 'border-vbk-purple', 'text-white');
            activeLink.classList.remove('text-gray-400');

            // Update page
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');

            // Update title
            const titles = { dashboard: 'Dashboard', products: 'Products', categories: 'Categories', orders: 'Orders', offers: 'Offers', customers: 'Customers' };
            document.getElementById('page-title').textContent = titles[page];
        }

        // === PRODUCTS ===
        let products = [];

        async function loadProducts() {
            const { data, error } = await supabase.from('products').select('*').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading products:', error);
                return;
            }
            products = data || [];
            renderProducts();
            document.getElementById('stat-products').textContent = products.length;
        }

        function renderProducts(filter = '', category = '') {
            const table = document.getElementById('products-table');
            let filtered = products;

            if (filter) {
                filtered = filtered.filter(p => p.title.toLowerCase().includes(filter.toLowerCase()));
            }
            if (category) {
                filtered = filtered.filter(p => p.cat === category);
            }

            if (filtered.length === 0) {
                table.innerHTML = '<tr><td colspan="6" class="p-8 text-center text-gray-500">No products found. Add your first product!</td></tr>';
                return;
            }

            table.innerHTML = filtered.map(p => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4">
                        <img src="${p.img}" alt="${p.title}" class="w-16 h-16 object-cover rounded-lg">
                    </td>
                    <td class="p-4">
                        <p class="font-medium">${p.title}</p>
                        <p class="text-xs text-gray-500">${p.sub || '-'}</p>
                    </td>
                    <td class="p-4 capitalize">${p.cat.replace(/-/g, ' ')}</td>
                    <td class="p-4">
                        <span class="text-vbk-gold font-bold">â‚¹${p.price}</span>
                        ${p.discount > 0 ? `<span class="text-xs text-pink-400 ml-2">${p.discount}% OFF</span>` : ''}
                    </td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded text-xs ${p.is_active ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                            ${p.is_active ? 'Active' : 'Inactive'}
                        </span>
                        ${p.is_bestseller ? '<span class="ml-2 px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400">Bestseller</span>' : ''}
                    </td>
                    <td class="p-4">
                        <button onclick="editProduct('${p.id}')" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct('${p.id}')" class="text-red-400 hover:text-red-300">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Product search/filter
        document.getElementById('product-search').addEventListener('input', (e) => {
            renderProducts(e.target.value, document.getElementById('product-filter').value);
        });
        document.getElementById('product-filter').addEventListener('change', (e) => {
            renderProducts(document.getElementById('product-search').value, e.target.value);
        });

        // Product Modal
        let galleryImages = [];

        function openProductModal(id = null) {
            document.getElementById('product-modal').classList.remove('hidden');
            document.getElementById('product-modal-title').textContent = id ? 'Edit Product' : 'Add Product';
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-active').checked = true;
            galleryImages = [];
            updateGalleryPreview();
            resetMainImagePreview();

            if (id) {
                const p = products.find(prod => prod.id === id);
                if (p) {
                    document.getElementById('product-id').value = p.id;
                    document.getElementById('product-title').value = p.title;
                    document.getElementById('product-cat').value = p.cat;
                    loadSubcategoriesForProduct(p.cat, p.sub);
                    document.getElementById('product-price').value = p.price;
                    document.getElementById('product-discount').value = p.discount || 0;
                    document.getElementById('product-img').value = p.img;
                    document.getElementById('product-desc').value = p.description || '';
                    document.getElementById('product-active').checked = p.is_active;
                    document.getElementById('product-bestseller').checked = p.is_bestseller;
                    document.getElementById('product-new').checked = p.is_new || false;

                    // Load gallery images
                    if (p.images && Array.isArray(p.images)) {
                        galleryImages = [...p.images];
                        updateGalleryPreview();
                    }

                    // Preview main image
                    previewMainImage();
                }
            }
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
            galleryImages = [];
        }

        function editProduct(id) {
            openProductModal(id);
        }

        // Main image preview
        function previewMainImage() {
            const url = document.getElementById('product-img').value;
            const preview = document.getElementById('main-img-preview');
            if (url) {
                preview.innerHTML = `<img src="${url}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<i class=\\'fa-solid fa-image text-gray-500\\'></i>'">`;
            } else {
                resetMainImagePreview();
            }
        }

        function resetMainImagePreview() {
            document.getElementById('main-img-preview').innerHTML = '<i class="fa-solid fa-image text-gray-500"></i>';
        }

        // Gallery functions
        function addGalleryImage() {
            const input = document.getElementById('gallery-img-input');
            const url = input.value.trim();

            if (!url) {
                toast('Please enter an image URL', 'error');
                return;
            }

            if (galleryImages.length >= 10) {
                toast('Maximum 10 gallery images allowed', 'error');
                return;
            }

            if (galleryImages.includes(url)) {
                toast('This image is already added', 'error');
                return;
            }

            galleryImages.push(url);
            updateGalleryPreview();
            input.value = '';
            toast('Image added!', 'success');
        }

        function removeGalleryImage(index) {
            galleryImages.splice(index, 1);
            updateGalleryPreview();
        }

        function updateGalleryPreview() {
            const container = document.getElementById('gallery-preview');
            document.getElementById('gallery-count').textContent = galleryImages.length;

            if (galleryImages.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No gallery images added yet</p>';
                return;
            }

            container.innerHTML = galleryImages.map((url, i) => `
                <div class="relative group">
                    <img src="${url}" class="w-16 h-16 object-cover rounded-lg border-2 border-vbk-mid" 
                        onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%231c2136%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%23666%22 font-size=%2212%22>Error</text></svg>'">
                    <button type="button" onclick="removeGalleryImage(${i})"
                        class="absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // Load subcategories when category changes
        document.getElementById('product-cat')?.addEventListener('change', (e) => {
            loadSubcategoriesForProduct(e.target.value);
        });

        function loadSubcategoriesForProduct(categorySlug, selectedSub = null) {
            const subSelect = document.getElementById('product-sub');
            if (!subSelect) return;

            // Find category by slug
            const cat = categories.find(c => c.slug === categorySlug);
            if (!cat) {
                subSelect.innerHTML = '<option value="">Select Subcategory</option>';
                return;
            }

            // Filter subcategories by category_id
            const subs = subcategories.filter(s => s.category_id === cat.id);
            subSelect.innerHTML = '<option value="">Select Subcategory</option>' +
                subs.map(s => `<option value="${s.slug}" ${s.slug === selectedSub ? 'selected' : ''}>${s.name}</option>`).join('');
        }

        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('product-id').value;
            const productData = {
                title: document.getElementById('product-title').value,
                cat: document.getElementById('product-cat').value,
                sub: document.getElementById('product-sub').value || null,
                price: parseInt(document.getElementById('product-price').value),
                discount: parseInt(document.getElementById('product-discount').value) || 0,
                img: document.getElementById('product-img').value,
                images: galleryImages,
                description: document.getElementById('product-desc').value || null,
                is_active: document.getElementById('product-active').checked,
                is_bestseller: document.getElementById('product-bestseller').checked,
                is_new: document.getElementById('product-new').checked
            };

            // Calculate original price from discount
            if (productData.discount > 0) {
                productData.original_price = Math.round(productData.price / (1 - productData.discount / 100));
            }

            let result;
            if (id) {
                productData.updated_at = new Date().toISOString();
                result = await supabase.from('products').update(productData).eq('id', id);
            } else {
                result = await supabase.from('products').insert([productData]);
            }

            if (result.error) {
                toast('Error saving product: ' + result.error.message, 'error');
            } else {
                toast(id ? 'Product updated!' : 'Product added!', 'success');
                closeProductModal();
                loadProducts();
            }
        });

        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            const { error } = await supabase.from('products').delete().eq('id', id);
            if (error) {
                toast('Error deleting product', 'error');
            } else {
                toast('Product deleted', 'success');
                loadProducts();
            }
        }

        // === OFFERS ===
        let offers = [];

        async function loadOffers() {
            const { data, error } = await supabase.from('offers').select('*').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading offers:', error);
                return;
            }
            offers = data || [];
            renderOffers();
            document.getElementById('stat-offers').textContent = offers.filter(o => o.is_active).length;
        }

        function renderOffers() {
            const table = document.getElementById('offers-table');
            if (offers.length === 0) {
                table.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-500">No offers yet. Create your first coupon!</td></tr>';
                return;
            }

            table.innerHTML = offers.map(o => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4 font-mono font-bold text-vbk-gold">${o.code}</td>
                    <td class="p-4 text-gray-300">${o.description || '-'}</td>
                    <td class="p-4">${o.discount_percent}%</td>
                    <td class="p-4">â‚¹${o.min_order || 0}</td>
                    <td class="p-4 text-sm">${o.valid_until ? new Date(o.valid_until).toLocaleDateString() : 'No expiry'}</td>
                    <td class="p-4">
                        <button onclick="toggleOfferStatus('${o.id}', ${!o.is_active})" 
                            class="px-2 py-1 rounded text-xs ${o.is_active ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                            ${o.is_active ? 'Active' : 'Inactive'}
                        </button>
                    </td>
                    <td class="p-4">
                        <button onclick="editOffer('${o.id}')" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button onclick="deleteOffer('${o.id}')" class="text-red-400 hover:text-red-300">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function openOfferModal(id = null) {
            document.getElementById('offer-modal').classList.remove('hidden');
            document.getElementById('offer-modal-title').textContent = id ? 'Edit Offer' : 'Add Offer';
            document.getElementById('offer-form').reset();
            document.getElementById('offer-id').value = '';
            document.getElementById('offer-active').checked = true;

            if (id) {
                const o = offers.find(offer => offer.id === id);
                if (o) {
                    document.getElementById('offer-id').value = o.id;
                    document.getElementById('offer-code').value = o.code;
                    document.getElementById('offer-desc').value = o.description || '';
                    document.getElementById('offer-discount').value = o.discount_percent;
                    document.getElementById('offer-min').value = o.min_order || 0;
                    document.getElementById('offer-valid').value = o.valid_until ? o.valid_until.split('T')[0] : '';
                    document.getElementById('offer-active').checked = o.is_active;
                }
            }
        }

        function closeOfferModal() {
            document.getElementById('offer-modal').classList.add('hidden');
        }

        function editOffer(id) {
            openOfferModal(id);
        }

        document.getElementById('offer-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('offer-id').value;
            const offerData = {
                code: document.getElementById('offer-code').value.toUpperCase(),
                description: document.getElementById('offer-desc').value || null,
                discount_percent: parseInt(document.getElementById('offer-discount').value) || 0,
                min_order: parseInt(document.getElementById('offer-min').value) || 0,
                valid_until: document.getElementById('offer-valid').value || null,
                is_active: document.getElementById('offer-active').checked
            };

            let result;
            if (id) {
                result = await supabase.from('offers').update(offerData).eq('id', id);
            } else {
                result = await supabase.from('offers').insert([offerData]);
            }

            if (result.error) {
                toast('Error saving offer: ' + result.error.message, 'error');
            } else {
                toast(id ? 'Offer updated!' : 'Offer created!', 'success');
                closeOfferModal();
                loadOffers();
            }
        });

        async function toggleOfferStatus(id, status) {
            const { error } = await supabase.from('offers').update({ is_active: status }).eq('id', id);
            if (!error) {
                loadOffers();
                toast(`Offer ${status ? 'activated' : 'deactivated'}`, 'success');
            }
        }

        async function deleteOffer(id) {
            if (!confirm('Are you sure you want to delete this offer?')) return;

            const { error } = await supabase.from('offers').delete().eq('id', id);
            if (error) {
                toast('Error deleting offer', 'error');
            } else {
                toast('Offer deleted', 'success');
                loadOffers();
            }
        }

        // === CUSTOMERS ===
        let customers = [];

        async function loadCustomers() {
            const { data, error } = await supabase.from('customers').select('*').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading customers:', error);
                return;
            }
            customers = data || [];
            renderCustomers();
            document.getElementById('stat-customers').textContent = customers.length;
        }

        function renderCustomers(filter = '') {
            const table = document.getElementById('customers-table');
            let filtered = customers;

            if (filter) {
                filtered = filtered.filter(c =>
                    c.name?.toLowerCase().includes(filter.toLowerCase()) ||
                    c.email?.toLowerCase().includes(filter.toLowerCase())
                );
            }

            if (filtered.length === 0) {
                table.innerHTML = '<tr><td colspan="6" class="p-8 text-center text-gray-500">No customers yet.</td></tr>';
                return;
            }

            table.innerHTML = filtered.map(c => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4 font-medium">${c.name || '-'}</td>
                    <td class="p-4">${c.email}</td>
                    <td class="p-4">${c.phone || '-'}</td>
                    <td class="p-4">${c.city || '-'}</td>
                    <td class="p-4">${c.orders_count || 0}</td>
                    <td class="p-4 text-sm text-gray-400">${new Date(c.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        document.getElementById('customer-search').addEventListener('input', (e) => {
            renderCustomers(e.target.value);
        });

        // === DASHBOARD STATS ===
        async function loadDashboardStats() {
            // Stats are loaded when individual tables load
        }

        // === CATEGORIES ===
        let categories = [];

        async function loadCategories() {
            const { data, error } = await supabase.from('categories').select('*').order('display_order');
            if (error) {
                console.error('Error loading categories:', error);
                return;
            }
            categories = data || [];
            renderCategories();
            populateCategoryDropdowns();
        }

        function renderCategories() {
            const table = document.getElementById('categories-table');
            if (categories.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-gray-500">No categories yet.</td></tr>';
                return;
            }

            table.innerHTML = categories.map(c => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4">
                        ${c.icon ? `<i class="fa-solid ${c.icon} mr-2 text-vbk-gold"></i>` : ''}
                        ${c.name}
                    </td>
                    <td class="p-4 text-gray-400 text-sm font-mono">${c.slug}</td>
                    <td class="p-4">-</td>
                    <td class="p-4">
                        <button onclick="editCategory('${c.id}')" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button onclick="deleteCategory('${c.id}')" class="text-red-400 hover:text-red-300">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populateCategoryDropdowns() {
            const subcatParent = document.getElementById('subcategory-parent');
            const productCat = document.getElementById('product-cat');
            const productFilter = document.getElementById('product-filter');

            const options = '<option value="">Select Category</option>' +
                categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            if (subcatParent) subcatParent.innerHTML = options;

            // Also update product dropdowns with slug-based values
            const slugOptions = '<option value="">All Categories</option>' +
                categories.map(c => `<option value="${c.slug}">${c.name}</option>`).join('');
            if (productFilter) productFilter.innerHTML = slugOptions;

            const productOptions = '<option value="">Select Category</option>' +
                categories.map(c => `<option value="${c.slug}">${c.name}</option>`).join('');
            if (productCat) productCat.innerHTML = productOptions;
        }

        function openCategoryModal(id = null) {
            document.getElementById('category-modal').classList.remove('hidden');
            document.getElementById('category-modal-title').textContent = id ? 'Edit Category' : 'Add Category';
            document.getElementById('category-form').reset();
            document.getElementById('category-id').value = '';

            if (id) {
                const c = categories.find(cat => cat.id === id);
                if (c) {
                    document.getElementById('category-id').value = c.id;
                    document.getElementById('category-name').value = c.name;
                    document.getElementById('category-slug').value = c.slug;
                    document.getElementById('category-icon').value = c.icon || '';
                    document.getElementById('category-image').value = c.image_url || '';
                }
            }
        }

        function closeCategoryModal() {
            document.getElementById('category-modal').classList.add('hidden');
        }

        function editCategory(id) {
            openCategoryModal(id);
        }

        document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('category-id').value;
            const catData = {
                name: document.getElementById('category-name').value,
                slug: document.getElementById('category-slug').value.toLowerCase().replace(/\s+/g, '-'),
                icon: document.getElementById('category-icon').value || null,
                image_url: document.getElementById('category-image').value || null
            };

            let result;
            if (id) {
                result = await supabase.from('categories').update(catData).eq('id', id);
            } else {
                catData.display_order = categories.length + 1;
                result = await supabase.from('categories').insert([catData]);
            }

            if (result.error) {
                toast('Error: ' + result.error.message, 'error');
            } else {
                toast(id ? 'Category updated!' : 'Category added!', 'success');
                closeCategoryModal();
                loadCategories();
            }
        });

        async function deleteCategory(id) {
            if (!confirm('Delete this category? Products in this category will become uncategorized.')) return;
            const { error } = await supabase.from('categories').delete().eq('id', id);
            if (error) {
                toast('Error deleting category', 'error');
            } else {
                toast('Category deleted', 'success');
                loadCategories();
            }
        }

        // === SUBCATEGORIES ===
        let subcategories = [];

        async function loadSubcategories() {
            const { data, error } = await supabase.from('subcategories').select('*, categories(name)').order('display_order');
            if (error) {
                console.error('Error loading subcategories:', error);
                return;
            }
            subcategories = data || [];
            renderSubcategories();
        }

        function renderSubcategories() {
            const table = document.getElementById('subcategories-table');
            if (subcategories.length === 0) {
                table.innerHTML = '<tr><td colspan="3" class="p-8 text-center text-gray-500">No subcategories yet.</td></tr>';
                return;
            }

            table.innerHTML = subcategories.map(s => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4">${s.name}</td>
                    <td class="p-4 text-gray-400 text-sm">${s.categories?.name || '-'}</td>
                    <td class="p-4">
                        <button onclick="editSubcategory('${s.id}')" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button onclick="deleteSubcategory('${s.id}')" class="text-red-400 hover:text-red-300">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function openSubcategoryModal(id = null) {
            document.getElementById('subcategory-modal').classList.remove('hidden');
            document.getElementById('subcategory-modal-title').textContent = id ? 'Edit Subcategory' : 'Add Subcategory';
            document.getElementById('subcategory-form').reset();
            document.getElementById('subcategory-id').value = '';

            if (id) {
                const s = subcategories.find(sub => sub.id === id);
                if (s) {
                    document.getElementById('subcategory-id').value = s.id;
                    document.getElementById('subcategory-parent').value = s.category_id;
                    document.getElementById('subcategory-name').value = s.name;
                    document.getElementById('subcategory-slug').value = s.slug;
                }
            }
        }

        function closeSubcategoryModal() {
            document.getElementById('subcategory-modal').classList.add('hidden');
        }

        function editSubcategory(id) {
            openSubcategoryModal(id);
        }

        document.getElementById('subcategory-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('subcategory-id').value;
            const subData = {
                category_id: document.getElementById('subcategory-parent').value,
                name: document.getElementById('subcategory-name').value,
                slug: document.getElementById('subcategory-slug').value.toLowerCase().replace(/\s+/g, '-')
            };

            let result;
            if (id) {
                result = await supabase.from('subcategories').update(subData).eq('id', id);
            } else {
                result = await supabase.from('subcategories').insert([subData]);
            }

            if (result.error) {
                toast('Error: ' + result.error.message, 'error');
            } else {
                toast(id ? 'Subcategory updated!' : 'Subcategory added!', 'success');
                closeSubcategoryModal();
                loadSubcategories();
            }
        });

        async function deleteSubcategory(id) {
            if (!confirm('Delete this subcategory?')) return;
            const { error } = await supabase.from('subcategories').delete().eq('id', id);
            if (error) {
                toast('Error deleting subcategory', 'error');
            } else {
                toast('Subcategory deleted', 'success');
                loadSubcategories();
            }
        }

        // === ORDERS ===
        let orders = [];

        async function loadOrders() {
            const { data, error } = await supabase.from('orders').select('*, customers(name, email, phone)').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading orders:', error);
                return;
            }
            orders = data || [];
            renderOrders();
        }

        function renderOrders(statusFilter = '', search = '') {
            const table = document.getElementById('orders-table');
            let filtered = orders;

            if (statusFilter) {
                filtered = filtered.filter(o => o.status === statusFilter);
            }
            if (search) {
                filtered = filtered.filter(o => o.order_number?.toLowerCase().includes(search.toLowerCase()));
            }

            if (filtered.length === 0) {
                table.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-500">No orders found.</td></tr>';
                return;
            }

            const statusColors = {
                pending: 'bg-yellow-500/20 text-yellow-400',
                accepted: 'bg-green-500/20 text-green-400',
                processing: 'bg-blue-500/20 text-blue-400',
                shipped: 'bg-purple-500/20 text-purple-400',
                delivered: 'bg-emerald-500/20 text-emerald-400',
                cancelled: 'bg-red-500/20 text-red-400'
            };

            const statusEmoji = {
                pending: 'ðŸŸ¡',
                accepted: 'ðŸŸ¢',
                processing: 'ðŸ”µ',
                shipped: 'ðŸŸ£',
                delivered: 'âœ…',
                cancelled: 'ðŸ”´'
            };

            table.innerHTML = filtered.map(o => `
                <tr class="border-t border-vbk-mid/20">
                    <td class="p-4 font-mono font-bold text-vbk-gold">${o.order_number || '-'}</td>
                    <td class="p-4">
                        <p class="font-medium">${o.customers?.name || 'Guest'}</p>
                        <p class="text-xs text-gray-500">${o.customers?.email || ''}</p>
                    </td>
                    <td class="p-4">${Array.isArray(o.items) ? o.items.length : 0} items</td>
                    <td class="p-4 font-bold">â‚¹${o.total_amount}</td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded text-xs ${statusColors[o.status]}">
                            ${statusEmoji[o.status]} ${o.status}
                        </span>
                    </td>
                    <td class="p-4 text-sm text-gray-400">${new Date(o.created_at).toLocaleDateString()}</td>
                    <td class="p-4">
                        <button onclick="viewOrder('${o.id}')" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        <a href="https://wa.me/${o.customers?.phone}" target="_blank" class="text-green-400 hover:text-green-300">
                            <i class="fa-brands fa-whatsapp"></i>
                        </a>
                    </td>
                </tr>
            `).join('');
        }

        document.getElementById('order-status-filter')?.addEventListener('change', (e) => {
            renderOrders(e.target.value, document.getElementById('order-search').value);
        });

        document.getElementById('order-search')?.addEventListener('input', (e) => {
            renderOrders(document.getElementById('order-status-filter').value, e.target.value);
        });

        function viewOrder(id) {
            const o = orders.find(order => order.id === id);
            if (!o) return;

            document.getElementById('order-modal').classList.remove('hidden');
            document.getElementById('order-modal-title').textContent = `Order ${o.order_number}`;
            document.getElementById('order-id').value = o.id;
            document.getElementById('order-status').value = o.status;
            document.getElementById('order-carrier').value = o.shipping_carrier || '';
            document.getElementById('order-tracking').value = o.tracking_number || '';
            document.getElementById('order-delivery').value = o.estimated_delivery || '';
            document.getElementById('order-notes').value = o.admin_notes || '';

            // Render order details
            const items = Array.isArray(o.items) ? o.items : [];
            document.getElementById('order-detail').innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Customer</span>
                        <span>${o.customers?.name || 'Guest'} (${o.customers?.phone || '-'})</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Total</span>
                        <span class="font-bold text-vbk-gold">â‚¹${o.total_amount}</span>
                    </div>
                    <div class="border-t border-vbk-mid/30 pt-4">
                        <p class="text-xs uppercase text-gray-500 mb-2">Items (${items.length})</p>
                        <div class="space-y-2 max-h-40 overflow-y-auto">
                            ${items.map(item => `
                                <div class="flex items-center gap-3 text-sm">
                                    <span class="text-gray-300">${item.title || 'Product'}</span>
                                    <span class="text-gray-500">x${item.qty || 1}</span>
                                    <span class="ml-auto text-vbk-gold">â‚¹${item.price || 0}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function closeOrderModal() {
            document.getElementById('order-modal').classList.add('hidden');
        }

        document.getElementById('order-update-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('order-id').value;
            const updateData = {
                status: document.getElementById('order-status').value,
                shipping_carrier: document.getElementById('order-carrier').value || null,
                tracking_number: document.getElementById('order-tracking').value || null,
                estimated_delivery: document.getElementById('order-delivery').value || null,
                admin_notes: document.getElementById('order-notes').value || null,
                updated_at: new Date().toISOString()
            };

            if (updateData.status === 'accepted' && !orders.find(o => o.id === id)?.payment_verified) {
                updateData.payment_verified = true;
                updateData.payment_verified_at = new Date().toISOString();
            }

            const { error } = await supabase.from('orders').update(updateData).eq('id', id);
            if (error) {
                toast('Error updating order', 'error');
            } else {
                toast('Order updated!', 'success');
                closeOrderModal();
                loadOrders();
            }
        });

        // === TOAST ===
        function toast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const colors = {
                success: 'border-green-500 text-green-400',
                error: 'border-red-500 text-red-400',
                info: 'border-blue-500 text-blue-400'
            };
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };

            const el = document.createElement('div');
            el.className = `toast bg-vbk-card border-l-4 ${colors[type]} p-4 rounded shadow-2xl flex items-center gap-3 min-w-[250px]`;
            el.innerHTML = `
                <i class="fa-solid ${icons[type]}"></i>
                <span class="text-sm text-white">${message}</span>
            `;
            container.appendChild(el);

            setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        // === INIT ===
        checkSession();

    </script>
</body>

</html>